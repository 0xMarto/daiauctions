"use strict";const FLIPPER_ABI=[{inputs:[{internalType:"address",name:"vat_",type:"address"},{internalType:"bytes32",name:"ilk_",type:"bytes32"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"id",type:"uint256"},{indexed:!1,internalType:"uint256",name:"lot",type:"uint256"},{indexed:!1,internalType:"uint256",name:"bid",type:"uint256"},{indexed:!1,internalType:"uint256",name:"tab",type:"uint256"},{indexed:!0,internalType:"address",name:"usr",type:"address"},{indexed:!0,internalType:"address",name:"gal",type:"address"}],name:"Kick",type:"event"},{anonymous:!0,inputs:[{indexed:!0,internalType:"bytes4",name:"sig",type:"bytes4"},{indexed:!0,internalType:"address",name:"usr",type:"address"},{indexed:!0,internalType:"bytes32",name:"arg1",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"arg2",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"data",type:"bytes"}],name:"LogNote",type:"event"},{constant:!0,inputs:[],name:"beg",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"bids",outputs:[{internalType:"uint256",name:"bid",type:"uint256"},{internalType:"uint256",name:"lot",type:"uint256"},{internalType:"address",name:"guy",type:"address"},{internalType:"uint48",name:"tic",type:"uint48"},{internalType:"uint48",name:"end",type:"uint48"},{internalType:"address",name:"usr",type:"address"},{internalType:"address",name:"gal",type:"address"},{internalType:"uint256",name:"tab",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"deal",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"uint256",name:"lot",type:"uint256"},{internalType:"uint256",name:"bid",type:"uint256"}],name:"dent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"deny",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"what",type:"bytes32"},{internalType:"uint256",name:"data",type:"uint256"}],name:"file",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"ilk",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"},{internalType:"address",name:"gal",type:"address"},{internalType:"uint256",name:"tab",type:"uint256"},{internalType:"uint256",name:"lot",type:"uint256"},{internalType:"uint256",name:"bid",type:"uint256"}],name:"kick",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"kicks",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"rely",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"tau",outputs:[{internalType:"uint48",name:"",type:"uint48"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"uint256",name:"lot",type:"uint256"},{internalType:"uint256",name:"bid",type:"uint256"}],name:"tend",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"tick",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"ttl",outputs:[{internalType:"uint48",name:"",type:"uint48"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"vat",outputs:[{internalType:"contract VatLike",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"wards",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"id",type:"uint256"}],name:"yank",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],MEDIANIZER_ABI=[{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"val",type:"uint256"},{indexed:!1,internalType:"uint256",name:"age",type:"uint256"}],name:"LogMedianPrice",type:"event"},{anonymous:!0,inputs:[{indexed:!0,internalType:"bytes4",name:"sig",type:"bytes4"},{indexed:!0,internalType:"address",name:"usr",type:"address"},{indexed:!0,internalType:"bytes32",name:"arg1",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"arg2",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"data",type:"bytes"}],name:"LogNote",type:"event"},{constant:!0,inputs:[],name:"age",outputs:[{internalType:"uint32",name:"",type:"uint32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"bar",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"bud",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"deny",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address[]",name:"a",type:"address[]"}],name:"diss",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"a",type:"address"}],name:"diss",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address[]",name:"a",type:"address[]"}],name:"drop",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address[]",name:"a",type:"address[]"}],name:"kiss",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"a",type:"address"}],name:"kiss",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address[]",name:"a",type:"address[]"}],name:"lift",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"orcl",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"peek",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"uint256[]",name:"val_",type:"uint256[]"},{internalType:"uint256[]",name:"age_",type:"uint256[]"},{internalType:"uint8[]",name:"v",type:"uint8[]"},{internalType:"bytes32[]",name:"r",type:"bytes32[]"},{internalType:"bytes32[]",name:"s",type:"bytes32[]"}],name:"poke",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"read",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"rely",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"bar_",type:"uint256"}],name:"setBar",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"uint8",name:"",type:"uint8"}],name:"slot",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"wards",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"wat",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"}],CAT_ABI=[{inputs:[{internalType:"address",name:"vat_",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"ilk",type:"bytes32"},{indexed:!0,internalType:"address",name:"urn",type:"address"},{indexed:!1,internalType:"uint256",name:"ink",type:"uint256"},{indexed:!1,internalType:"uint256",name:"art",type:"uint256"},{indexed:!1,internalType:"uint256",name:"tab",type:"uint256"},{indexed:!1,internalType:"address",name:"flip",type:"address"},{indexed:!1,internalType:"uint256",name:"id",type:"uint256"}],name:"Bite",type:"event"},{anonymous:!0,inputs:[{indexed:!0,internalType:"bytes4",name:"sig",type:"bytes4"},{indexed:!0,internalType:"address",name:"usr",type:"address"},{indexed:!0,internalType:"bytes32",name:"arg1",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"arg2",type:"bytes32"},{indexed:!1,internalType:"bytes",name:"data",type:"bytes"}],name:"LogNote",type:"event"},{constant:!1,inputs:[{internalType:"bytes32",name:"ilk",type:"bytes32"},{internalType:"address",name:"urn",type:"address"}],name:"bite",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"cage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"deny",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ilk",type:"bytes32"},{internalType:"bytes32",name:"what",type:"bytes32"},{internalType:"uint256",name:"data",type:"uint256"}],name:"file",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"what",type:"bytes32"},{internalType:"address",name:"data",type:"address"}],name:"file",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"ilk",type:"bytes32"},{internalType:"bytes32",name:"what",type:"bytes32"},{internalType:"address",name:"flip",type:"address"}],name:"file",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"ilks",outputs:[{internalType:"address",name:"flip",type:"address"},{internalType:"uint256",name:"chop",type:"uint256"},{internalType:"uint256",name:"lump",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"live",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"usr",type:"address"}],name:"rely",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"vat",outputs:[{internalType:"contract VatLike",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"vow",outputs:[{internalType:"contract VowLike",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"}],name:"wards",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],BAT_FLIP_ADDRESS="0x5EdF770FC81E7b8C2c89f71F30f211226a4d7495",MEDIANIZER_ADDRESS="0x18B4633D6E39870f398597f3c1bA8c4A41294966",CAT_ADDRESS="0x78F2c2AF65126834c51822F56Be0d7469D7A523E",FLIP_ILK="0x4241542d41000000000000000000000000000000000000000000000000000000";var web3,usingRemoteProvider=!0;if(void 0!==window.ethereum&&window.ethereum.networkVersion&&"1"===window.ethereum.networkVersion&&window.ethereum.isMetaMask)try{(web3=new Web3(window.ethereum)).eth.subscribe("newBlockHeaders").unsubscribe(),console.log("Using local web3 provider"),usingRemoteProvider=!1}catch(e){usingRemoteProvider=!0}if(usingRemoteProvider){var infura="wss://mainnet.infura.io/ws/v3/f77d1e38219b45d4b4965a1c247c1aff",provider=new Web3.providers.WebsocketProvider(infura);web3=new Web3(provider),console.log("Using remote web3 provider")}const flipContract=new web3.eth.Contract(FLIPPER_ABI,BAT_FLIP_ADDRESS),medianizerContract=new web3.eth.Contract(MEDIANIZER_ABI,MEDIANIZER_ADDRESS),catContract=new web3.eth.Contract(CAT_ABI,CAT_ADDRESS);var events=[];async function getFlipEvents(e){return console.log(`Get auction events from block: ${e}`),flipContract.getPastEvents("allEvents",{fromBlock:e,toBlock:"latest"},function(e,t){e?console.log(e):(console.log("Received Events:",t.length),events=t)})}let cachePrice={block:0,val:0};async function getMedPrice(e){if(cachePrice.block===e)return cachePrice.val;let t=0;return await medianizerContract.getPastEvents("LogMedianPrice",{fromBlock:e-1e3,toBlock:e},function(e,n){if(e)console.log(e);else{var a=n[n.length-1];if(a){let e=web3.utils.toBN(a.returnValues[0]),n=web3.utils.fromWei(e);t=Number(parseFloat(n).toFixed(4))}}}),cachePrice={block:e,val:t},t}let cacheDate={block:0,val:new Date};async function getBlockDate(e){if(cacheDate.block===e)return cacheDate.val;let t=new Date;return await web3.eth.getBlock(e).then(function(n){if(n){let e=n.timestamp;t=new Date(1e3*e)}else console.log(`Block ${e}: error getting date`)}),cacheDate={block:e,val:t},t}const TEND="0x4b43ed1200000000000000000000000000000000000000000000000000000000",DENT="0x5ff3a38200000000000000000000000000000000000000000000000000000000",DEAL="0xc959c42b00000000000000000000000000000000000000000000000000000000",TICK="0xfc7b6aee00000000000000000000000000000000000000000000000000000000",FILE="0x29ae811400000000000000000000000000000000000000000000000000000000",DENY="0x9c52a7f100000000000000000000000000000000000000000000000000000000",RELY="0x65fae35e00000000000000000000000000000000000000000000000000000000";var auctions={},eventsLoaded=!1,showEvents=async function(e){0===Object.keys(auctions).length&&(document.getElementById("app").innerHTML=""),events.length>0&&hideFilterSearch();for(let t=0;t<events.length;t++){let n=events[t],a="",i=await getBlockDate(n.blockNumber),s={day:"numeric",month:"short",year:"numeric"};a=i.toLocaleString("en-GB",s)+" | ";let o="Unknown",l=0;if("Kick"===n.event){o="KICK",l=parseInt(n.returnValues.id,10),a+="ID: <b>"+l+"</b> | ";let e=n.returnValues.lot/1e18;a+="lot: "+e.toFixed(2)+" bat | ";let t=n.returnValues.tab/1e27/1e18;a+="tab: "+t.toFixed(2)+" dai | ";let s=await getMedPrice(n.blockNumber);auctions[l]={id:l,kickDate:i.toUTCString().slice(5),kickPrice:s.toString(),kickLot:e,tends:0,dents:0,bid:null,bidFrom:null,bidDate:null,bidPrice:null,lot:null,tab:t,guy:null,dealPrice:null,paidPrice:null,state:"OPEN"},a+=s>0?"Maker MED Price: $"+auctions[l].kickPrice+" | ":"Maker MED Price: $---,-- | "}else if(n.raw.topics[0]===TEND){if(o="TEND",l=parseInt(n.raw.topics[2],16),!auctions[l])continue;a+="ID: <b>"+l+"</b> | ";let e=parseInt(n.raw.topics[3],16)/1e18;a+="lot: "+e.toFixed(2)+" bat | ";let t=n.raw.data.slice(288,-248),s=parseInt(t,16)/1e27/1e18;a+="bid: "+s.toFixed(2)+" dai | ";let p=await getMedPrice(n.blockNumber);if(auctions[l].tends+=1,auctions[l].bid=s,auctions[l].bidDate=i.toUTCString().slice(5),auctions[l].bidPrice=p.toString(),auctions[l].lot=e,auctions[l].paidPrice=(s/e).toFixed(4),p>0){let e=100*(auctions[l].paidPrice/auctions[l].bidPrice-1);a+=e>0?"+"+e.toFixed(1)+" % | ":e.toFixed(1)+" % | ",a+="Price: $"+auctions[l].bidPrice+" | "}else a+="--,-- % | Price: $---,-- | "}else if(n.raw.topics[0]===DENT){if(o="DENT",l=parseInt(n.raw.topics[2],16),!auctions[l])continue;a+="ID: <b>"+l+"</b> | ";let e=parseInt(n.raw.topics[3],16)/1e18;a+="lot: "+e.toFixed(2)+" bat | ";let t=n.raw.data.slice(288,-248),s=parseInt(t,16)/1e27/1e18;a+="bid: "+s.toFixed(2)+" dai | ";let p=await getMedPrice(n.blockNumber);if(auctions[l].dents+=1,auctions[l].bid=s,auctions[l].bidDate=i.toUTCString().slice(5),auctions[l].bidPrice=p.toString(),auctions[l].lot=e,auctions[l].paidPrice=(s/e).toFixed(4),p>0){let e=100*(auctions[l].paidPrice/auctions[l].bidPrice-1);a+=e>0?"+"+e.toFixed(2)+" % | ":e.toFixed(2)+" % | ",a+="Price: $"+auctions[l].bidPrice+" | "}else a+="--,-- % | Price: $---,-- | "}else if(n.raw.topics[0]===DEAL){if(o="DEAL",l=parseInt(n.raw.topics[2],16),!auctions[l])continue;a+="ID: <b>"+l+"</b> | ";let e=await getMedPrice(n.blockNumber);if(auctions[l].dealPrice=e.toString(),auctions[l].state="CLOSE",e){a+="Paid Rate: $"+auctions[l].paidPrice+" dai/bat ";let e=100*(auctions[l].paidPrice/auctions[l].dealPrice-1);e>0?(a+="(+"+e.toFixed(2)+"%) ~ ",a+=`<b class='detail-btn' onclick='showAuctionDetails(${l})'>Lost ðŸ“‹</b> | `):(a+="("+e.toFixed(2)+"%) ~ ",a+=`<b class='detail-btn' onclick='showAuctionDetails(${l})'>Won! ðŸ“‹</b> | `),a+="Price: $"+auctions[l].dealPrice+" | "}else a+="Paid Rate: $"+auctions[l].paidPrice+" dai/bat (+-.--%) | ",a+="--,-- % | Price: $---,-- | "}else if(n.raw.topics[0]===TICK)o="TICK",l=parseInt(n.raw.topics[2],16),a+="ID: <b>"+l+"</b> | ",a+="Time extended! | ";else if(n.raw.topics[0]===FILE){auctions[0]={id:0,type:"FILE"},o="FILE";const e="0x6265670000000000000000000000000000000000000000000000000000000000",t="0x7461750000000000000000000000000000000000000000000000000000000000",i="0x74746c0000000000000000000000000000000000000000000000000000000000";if(n.raw.topics[2]===e){a+="WHAT: <b> BEG </b> (minimum bid increase) | ";let e=parseInt(n.raw.topics[3])/1e18;a+="VALUE: <b>"+(e=100*(e-1)).toFixed(2)+" %</b> | "}else if(n.raw.topics[2]===t){a+="WHAT: <b> TAU </b> (maximum auction duration) | ";let e=parseInt(n.raw.topics[3]);a+="VALUE: <b>"+(e=e/60/60).toFixed(1)+" hours</b> | "}else if(n.raw.topics[2]===i){a+="WHAT: <b> TTL </b> (bid lifetime / max bid duration) | ";let e=parseInt(n.raw.topics[3]);a+="VALUE: <b>"+(e/=60).toFixed(1)+" minutes</b> | "}else a+="WHAT: <b>UNKNOWN</b> | ",console.log(n.raw.topics);a+="New Flapper Update! | "}else if(n.raw.topics[0]===RELY){o="RELY",a+="WHAT: <b>Allow to call auth'ed methods --</b> | ";let e=n.raw.topics[2];a+="TO: <b>0x"+e.slice(-40)+"</b> | "}else if(n.raw.topics[0]===DENY){o="DENY",a+="WHAT: <b>Disallow to call auth'ed methods</b> | ";let e=n.raw.topics[2];a+="TO: <b>0x"+e.slice(-40)+"</b> | "}else console.log("UNKNOWN event"),console.log(n);await web3.eth.getTransaction(n.transactionHash).then(function(e){let t=e.from.slice(0,6)+"..."+e.from.slice(-4);auctions[l]&&("DENT"!==o&&"TEND"!==o||(auctions[l].bidFrom=e.from),auctions[l].txFrom=e.from);let i=`<a target="_blank" href="${`https://etherscan.io/tx/${n.transactionHash}`}">Tx:..${n.transactionHash.slice(-3)} Info</a>`;a+=`from: ${t} | ${i} >>`});let p=document.getElementById("app").innerHTML,u="";0!==e&&e!==l||(u='<div class="row flip-'+l+" "+o.toLowerCase()+'">'+o+" >> "+a+"</div>"),document.getElementById("app").innerHTML=u+p}Object.keys(auctions).length>0?showFilter():showEmptyMessage(),eventsLoaded=!0},lastBlockfetch=0,blocksBack=18095,fetchAuctions=async function(e){let t=(lastBlockfetch=await web3.eth.getBlockNumber())-blocksBack;await getFlipEvents(t),await showEvents(e)};async function newBlock(e,t){if(t){let e=t.number;if(!eventsLoaded)return;eventsLoaded=!1,await getFlipEvents(e),await showEvents(0)}else console.log(e)}async function updateGlobals(){let e=$("#globals");catContract.methods.ilks(FLIP_ILK).call().then(function(t){let n=parseInt(t.lump)/1e18,a=100*(parseInt(t.chop)/1e27-1);e.find("#lump").text(n.toLocaleString("en")),e.find("#chop").text(a.toFixed(2))}),flipContract.methods.beg().call().then(function(t){let n=100*(t/1e18-1);e.find("#beg").text(n.toFixed(2))}),flipContract.methods.ttl().call().then(function(t){let n=t/60;e.find("#ttl").text(n.toFixed(1))}),flipContract.methods.tau().call().then(function(t){let n=t/60/60;e.find("#tau").text(n.toFixed(1))});let t=await web3.eth.getBlockNumber(),n=await getMedPrice(t);e.find("#price-bat").text("$"+n.toLocaleString("en",{minimumFractionDigits:4,maximumFractionDigits:4}))}function showFilter(){let e=document.getElementById("filter-panel");if(e){e.style.display="block",document.getElementById("search").style.display="inline",document.getElementById("no-results").style.display="none",showLastUpdate()}}function showLastUpdate(){let e=document.getElementById("last-update"),t=(new Date).toLocaleString("en-GB");e.innerHTML=`- Updated to: ${t}`}function hideFilterSearch(){let e=document.getElementById("search");e&&(e.style.display="none")}function showEmptyMessage(){let e=document.getElementById("filter-panel");if(e){e.style.display="block",document.getElementById("search").style.display="none",document.getElementById("no-results").style.display="block",showLastUpdate()}}function filterAuctionById(){let e=$("#fliter-id").val(),t=$(".row");t.hide(),e?$(".flip-"+e).show():t.show()}function showAuctionDetails(e){let t=auctions[e];if(!t)return void alert("Error showing auction details");let n=$("#auction-details");n&&n.hide();let a=`> <b>AUCTION ID: ${e}</b>`;a+="<hr/>";let i={minimumFractionDigits:4,maximumFractionDigits:4};a+="Started: <br/>",a+=`- DATE: ${t.kickDate} <br/>`,a+=`- LOT: ${t.kickLot.toLocaleString("en",i)} bat `,a+=`- BID: ${t.bid.toLocaleString("en",i)} dai <br/>`,a+=`- BAT MED: $${t.kickPrice} bat/dai <br/><br/>`,a+=`Bids received: ${t.tends+t.dents} <br/><br/>`,a+="Last Bid:<br/>",a+=`- DATE: ${t.bidDate} <br/>`,a+=`- FROM: ${t.bidFrom} <br/>`,a+=`- LOT: ${t.lot.toLocaleString("en",i)} bat `,a+=`- BID: ${t.bid.toLocaleString("en",i)} dai <br/>`,a+=`- PAID PRICE: $${t.paidPrice} bat/dai <br/>`,a+=`- BAT MED: $${t.bidPrice} bat/dai <br/><br/>`,a+="Ended: <br/>",a+=`- DATE: ${t.dealDate} <br/>`,a+=`- FROM: ${t.txFrom} <br/>`,a+=`- PAID PRICE: $${t.paidPrice} bat/dai <br/>`,a+=`- BAT MED: $${t.dealPrice} bat/dai <br/><br/>`,a+="Results: <br/>",a+=`- PRICE DIFF: ${(100*(t.paidPrice/t.dealPrice-1)).toFixed(2)}% <br/>`,i={minimumFractionDigits:2,maximumFractionDigits:2},a+=`- PROFIT: <b>${(t.lot*t.dealPrice-t.bid).toLocaleString("en",i)} dai</b>`,a+="<hr/>",a+='<a style="float: right;" onclick="hideAuctionDetails()">CLOSE<a/>',n&&(n.html(a),n.fadeIn("normal"))}function hideAuctionDetails(){let e=$("#auction-details");e&&e.fadeOut("normal")}updateGlobals(),fetchAuctions(0),setTimeout(function(){console.log("Getting new data from chain..."),web3.eth.subscribe("newBlockHeaders",newBlock)},5e3);